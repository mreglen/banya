{"ast":null,"code":"// src/pages/Admin/Bookings/AdminBookings.jsx\nimport{useState}from'react';import{useGetBookingsQuery,useMarkBookingAsReadMutation}from'../../../redux/slices/apiSlice';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function AdminBookings(){const[markAsRead]=useMarkBookingAsReadMutation();const[expandedNotes,setExpandedNotes]=useState(new Set());const{data:bookings=[],isLoading,error}=useGetBookingsQuery();const handleMarkAsRead=async bookingId=>{try{await markAsRead(bookingId).unwrap();}catch(err){console.error('Ошибка при отметке заявки как прочитанной:',err);}};const toggleNote=bookingId=>{setExpandedNotes(prev=>{const newSet=new Set(prev);if(newSet.has(bookingId)){newSet.delete(bookingId);}else{newSet.add(bookingId);}return newSet;});};// Функция для обрезки текста до 100 символов\nconst truncateText=function(text){let maxLength=arguments.length>1&&arguments[1]!==undefined?arguments[1]:100;if(text.length<=maxLength)return text;return text.substring(0,maxLength)+'...';};if(isLoading){return/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center justify-center py-16\",children:/*#__PURE__*/_jsx(\"div\",{className:\"text-gray-500\",children:\"\\u0417\\u0430\\u0433\\u0440\\u0443\\u0437\\u043A\\u0430 \\u0437\\u0430\\u044F\\u0432\\u043E\\u043A...\"})});}if(error){return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-red-50 border border-red-200 rounded-xl p-6 text-red-700\",children:[\"\\u274C \\u041E\\u0448\\u0438\\u0431\\u043A\\u0430 \\u0437\\u0430\\u0433\\u0440\\u0443\\u0437\\u043A\\u0438 \\u0437\\u0430\\u044F\\u0432\\u043E\\u043A: \",error.message||'Неизвестная ошибка']});}return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-2xl shadow-md border border-gray-200 p-8\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-semibold text-gray-800 mb-6\",children:\"\\u0417\\u0430\\u044F\\u0432\\u043A\\u0438 \\u0441 \\u0441\\u0430\\u0439\\u0442\\u0430\"}),/*#__PURE__*/_jsx(\"div\",{className:\"space-y-4\",children:bookings.length===0?/*#__PURE__*/_jsx(\"div\",{className:\"text-gray-500 text-center py-8\",children:\"\\u041D\\u0435\\u0442 \\u0437\\u0430\\u044F\\u0432\\u043E\\u043A\"}):bookings.map(booking=>{var _booking$bath;return/*#__PURE__*/_jsxs(\"div\",{className:\"border rounded-xl p-6 transition-all \".concat(booking.isUnread?'border-blue-300 bg-blue-50 shadow-md':'border-gray-200 bg-white'),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-start mb-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 mb-2\",children:[booking.isUnread&&/*#__PURE__*/_jsx(\"span\",{className:\"w-3 h-3 bg-blue-500 rounded-full\"}),/*#__PURE__*/_jsxs(\"h3\",{className:\"font-medium text-gray-800\",children:[booking.name,\" \\u2014 \",booking.formattedDate]})]}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-600 mb-1\",children:[booking.phone,\" | \",booking.email||'—']}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-600 mb-1\",children:[\"\\u0411\\u0430\\u043D\\u044F: \",((_booking$bath=booking.bath)===null||_booking$bath===void 0?void 0:_booking$bath.name)||'—',\" | \",booking.duration_hours,\" \\u0447. | \",booking.guests,\" \\u0433\\u043E\\u0441\\u0442\\u0435\\u0439\"]}),booking.notes&&/*#__PURE__*/_jsxs(\"div\",{className:\"mt-2\",children:[/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-700 italic\",style:{whiteSpace:'pre-wrap',wordBreak:'break-word',overflowWrap:'break-word',hyphens:'auto'},children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\u041F\\u0440\\u0438\\u043C\\u0435\\u0447\\u0430\\u043D\\u0438\\u0435:\"}),' ',expandedNotes.has(booking.booking_id)?booking.notes:truncateText(booking.notes)]}),booking.notes.length>100&&/*#__PURE__*/_jsx(\"button\",{onClick:()=>toggleNote(booking.booking_id),className:\"text-blue-600 hover:text-blue-800 text-xs mt-1 underline\",children:expandedNotes.has(booking.booking_id)?'Свернуть':'Показать полностью'})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center gap-2\",children:/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleMarkAsRead(booking.booking_id),disabled:booking.is_read,className:\"px-3 py-1 rounded text-xs font-medium transition \".concat(booking.is_read?'bg-gray-200 text-gray-500 cursor-not-allowed':'bg-green-100 text-green-700 hover:bg-green-200'),children:booking.is_read?'Прочитано':'Отметить как прочитанное'})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs text-gray-500\",children:[\"\\u041E\\u0442\\u043F\\u0440\\u0430\\u0432\\u043B\\u0435\\u043D\\u043E: \",booking.formattedTime]})]},booking.booking_id);})})]});}export default AdminBookings;","map":{"version":3,"names":["useState","useGetBookingsQuery","useMarkBookingAsReadMutation","jsx","_jsx","jsxs","_jsxs","AdminBookings","markAsRead","expandedNotes","setExpandedNotes","Set","data","bookings","isLoading","error","handleMarkAsRead","bookingId","unwrap","err","console","toggleNote","prev","newSet","has","delete","add","truncateText","text","maxLength","arguments","length","undefined","substring","className","children","message","map","booking","_booking$bath","concat","isUnread","name","formattedDate","phone","email","bath","duration_hours","guests","notes","style","whiteSpace","wordBreak","overflowWrap","hyphens","booking_id","onClick","disabled","is_read","formattedTime"],"sources":["C:/Users/khram/Desktop/ilya/banya/frontend/my-banya/src/pages/Admin/AdminBookings/AdminBookings.jsx"],"sourcesContent":["// src/pages/Admin/Bookings/AdminBookings.jsx\r\n\r\nimport { useState } from 'react';\r\nimport { useGetBookingsQuery, useMarkBookingAsReadMutation } from '../../../redux/slices/apiSlice';\r\n\r\nfunction AdminBookings() {\r\n  const [markAsRead] = useMarkBookingAsReadMutation();\r\n  const [expandedNotes, setExpandedNotes] = useState(new Set());\r\n\r\n  const { data: bookings = [], isLoading, error } = useGetBookingsQuery();\r\n\r\n  const handleMarkAsRead = async (bookingId) => {\r\n    try {\r\n      await markAsRead(bookingId).unwrap();\r\n    } catch (err) {\r\n      console.error('Ошибка при отметке заявки как прочитанной:', err);\r\n    }\r\n  };\r\n\r\n  const toggleNote = (bookingId) => {\r\n    setExpandedNotes(prev => {\r\n      const newSet = new Set(prev);\r\n      if (newSet.has(bookingId)) {\r\n        newSet.delete(bookingId);\r\n      } else {\r\n        newSet.add(bookingId);\r\n      }\r\n      return newSet;\r\n    });\r\n  };\r\n\r\n  // Функция для обрезки текста до 100 символов\r\n  const truncateText = (text, maxLength = 100) => {\r\n    if (text.length <= maxLength) return text;\r\n    return text.substring(0, maxLength) + '...';\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center py-16\">\r\n        <div className=\"text-gray-500\">Загрузка заявок...</div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"bg-red-50 border border-red-200 rounded-xl p-6 text-red-700\">\r\n        ❌ Ошибка загрузки заявок: {error.message || 'Неизвестная ошибка'}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"bg-white rounded-2xl shadow-md border border-gray-200 p-8\">\r\n      <h2 className=\"text-2xl font-semibold text-gray-800 mb-6\">Заявки с сайта</h2>\r\n      <div className=\"space-y-4\">\r\n        {bookings.length === 0 ? (\r\n          <div className=\"text-gray-500 text-center py-8\">\r\n            Нет заявок\r\n          </div>\r\n        ) : (\r\n          bookings.map((booking) => (\r\n            <div\r\n              key={booking.booking_id}\r\n              className={`border rounded-xl p-6 transition-all ${\r\n                booking.isUnread\r\n                  ? 'border-blue-300 bg-blue-50 shadow-md'\r\n                  : 'border-gray-200 bg-white'\r\n              }`}\r\n            >\r\n              <div className=\"flex justify-between items-start mb-4\">\r\n                <div className=\"flex-1\">\r\n                  <div className=\"flex items-center gap-2 mb-2\">\r\n                    {booking.isUnread && (\r\n                      <span className=\"w-3 h-3 bg-blue-500 rounded-full\"></span>\r\n                    )}\r\n                    <h3 className=\"font-medium text-gray-800\">\r\n                      {booking.name} — {booking.formattedDate}\r\n                    </h3>\r\n                  </div>\r\n                  <p className=\"text-sm text-gray-600 mb-1\">\r\n                    {booking.phone} | {booking.email || '—'}\r\n                  </p>\r\n                  <p className=\"text-sm text-gray-600 mb-1\">\r\n                    Баня: {booking.bath?.name || '—'} | {booking.duration_hours} ч. | {booking.guests} гостей\r\n                  </p>\r\n                  {booking.notes && (\r\n                    <div className=\"mt-2\">\r\n                      <p \r\n                        className=\"text-sm text-gray-700 italic\"\r\n                        style={{\r\n                          whiteSpace: 'pre-wrap',\r\n                          wordBreak: 'break-word',\r\n                          overflowWrap: 'break-word',\r\n                          hyphens: 'auto'\r\n                        }}\r\n                      >\r\n                        <strong>Примечание:</strong>{' '}\r\n                        {expandedNotes.has(booking.booking_id) \r\n                          ? booking.notes \r\n                          : truncateText(booking.notes)\r\n                        }\r\n                      </p>\r\n                      {booking.notes.length > 100 && (\r\n                        <button\r\n                          onClick={() => toggleNote(booking.booking_id)}\r\n                          className=\"text-blue-600 hover:text-blue-800 text-xs mt-1 underline\"\r\n                        >\r\n                          {expandedNotes.has(booking.booking_id) ? 'Свернуть' : 'Показать полностью'}\r\n                        </button>\r\n                      )}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n                <div className=\"flex items-center gap-2\">\r\n                  <button\r\n                    onClick={() => handleMarkAsRead(booking.booking_id)}\r\n                    disabled={booking.is_read}\r\n                    className={`px-3 py-1 rounded text-xs font-medium transition ${\r\n                      booking.is_read\r\n                        ? 'bg-gray-200 text-gray-500 cursor-not-allowed'\r\n                        : 'bg-green-100 text-green-700 hover:bg-green-200'\r\n                    }`}\r\n                  >\r\n                    {booking.is_read ? 'Прочитано' : 'Отметить как прочитанное'}\r\n                  </button>\r\n                </div>\r\n              </div>\r\n              <div className=\"text-xs text-gray-500\">\r\n                Отправлено: {booking.formattedTime}\r\n              </div>\r\n            </div>\r\n          ))\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default AdminBookings;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}