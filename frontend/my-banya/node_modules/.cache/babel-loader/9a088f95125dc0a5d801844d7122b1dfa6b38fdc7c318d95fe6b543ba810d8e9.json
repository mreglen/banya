{"ast":null,"code":"import{createSlice,createAsyncThunk}from'@reduxjs/toolkit';import axios from'axios';// 🔐 Безопасное получение VITE_API_URL\nconst getApiUrl=()=>{// Проверяем, что import.meta и import.meta.env доступны\nif(typeof import.meta!=='undefined'&&import.meta.env){// return import.meta.env.VITE_API_URL || 'http://127.0.0.1:8000';\nreturn import.meta.env.VITE_API_URL||'http://192.168.0.100:3001';}// Если import.meta недоступен (редкий случай, но бывает при HMR или ошибках сборки)\n// return 'http://127.0.0.1:8000';\nreturn'http://192.168.0.100:3001';};const API_BASE_URL=getApiUrl();export const createBooking=createAsyncThunk('booking/createBooking',async(bookingData,_ref)=>{let{rejectWithValue}=_ref;try{const response=await axios.post(\"\".concat(API_BASE_URL,\"/api/bookings/\"),bookingData);return response.data;}catch(error){var _error$response,_error$response2,_error$response2$data;// Логируем ошибку для отладки\nconsole.error('Ошибка при отправке брони:',((_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.data)||error.message);return rejectWithValue(((_error$response2=error.response)===null||_error$response2===void 0?void 0:(_error$response2$data=_error$response2.data)===null||_error$response2$data===void 0?void 0:_error$response2$data.detail)||error.message||'Не удалось отправить бронь');}});const bookingSlice=createSlice({name:'booking',initialState:{loading:false,error:null,success:false},reducers:{resetStatus:state=>{state.loading=false;state.success=false;state.error=null;}},extraReducers:builder=>{builder.addCase(createBooking.pending,state=>{state.loading=true;state.error=null;state.success=false;}).addCase(createBooking.fulfilled,state=>{state.loading=false;state.success=true;}).addCase(createBooking.rejected,(state,action)=>{state.loading=false;state.error=action.payload;});}});export const{resetStatus}=bookingSlice.actions;export default bookingSlice.reducer;","map":{"version":3,"names":["createSlice","createAsyncThunk","axios","getApiUrl","import","meta","env","VITE_API_URL","API_BASE_URL","createBooking","bookingData","_ref","rejectWithValue","response","post","concat","data","error","_error$response","_error$response2","_error$response2$data","console","message","detail","bookingSlice","name","initialState","loading","success","reducers","resetStatus","state","extraReducers","builder","addCase","pending","fulfilled","rejected","action","payload","actions","reducer"],"sources":["C:/Users/khram/Desktop/ilya/banya/frontend/my-banya/src/redux/slices/bookingSlice.js"],"sourcesContent":["import { createSlice, createAsyncThunk } from '@reduxjs/toolkit';\r\nimport axios from 'axios';\r\n\r\n// 🔐 Безопасное получение VITE_API_URL\r\nconst getApiUrl = () => {\r\n  // Проверяем, что import.meta и import.meta.env доступны\r\n  if (typeof import.meta !== 'undefined' && import.meta.env) {\r\n    // return import.meta.env.VITE_API_URL || 'http://127.0.0.1:8000';\r\n    return import.meta.env.VITE_API_URL || 'http://192.168.0.100:3001';\r\n  }\r\n  // Если import.meta недоступен (редкий случай, но бывает при HMR или ошибках сборки)\r\n  // return 'http://127.0.0.1:8000';\r\n  return 'http://192.168.0.100:3001';\r\n};\r\n\r\nconst API_BASE_URL = getApiUrl();\r\n\r\nexport const createBooking = createAsyncThunk(\r\n  'booking/createBooking',\r\n  async (bookingData, { rejectWithValue }) => {\r\n    try {\r\n      const response = await axios.post(`${API_BASE_URL}/api/bookings/`, bookingData);\r\n      return response.data;\r\n    } catch (error) {\r\n      // Логируем ошибку для отладки\r\n      console.error('Ошибка при отправке брони:', error.response?.data || error.message);\r\n      return rejectWithValue(\r\n        error.response?.data?.detail || \r\n        error.message || \r\n        'Не удалось отправить бронь'\r\n      );\r\n    }\r\n  }\r\n);\r\n\r\nconst bookingSlice = createSlice({\r\n  name: 'booking',\r\n  initialState: {\r\n    loading: false,\r\n    error: null,\r\n    success: false,\r\n  },\r\n  reducers: {\r\n    resetStatus: (state) => {\r\n      state.loading = false;\r\n      state.success = false;\r\n      state.error = null;\r\n    },\r\n  },\r\n  extraReducers: (builder) => {\r\n    builder\r\n      .addCase(createBooking.pending, (state) => {\r\n        state.loading = true;\r\n        state.error = null;\r\n        state.success = false;\r\n      })\r\n      .addCase(createBooking.fulfilled, (state) => {\r\n        state.loading = false;\r\n        state.success = true;\r\n      })\r\n      .addCase(createBooking.rejected, (state, action) => {\r\n        state.loading = false;\r\n        state.error = action.payload;\r\n      });\r\n  },\r\n});\r\n\r\nexport const { resetStatus } = bookingSlice.actions;\r\nexport default bookingSlice.reducer;"],"mappings":"AAAA,OAASA,WAAW,CAAEC,gBAAgB,KAAQ,kBAAkB,CAChE,MAAO,CAAAC,KAAK,KAAM,OAAO,CAEzB;AACA,KAAM,CAAAC,SAAS,CAAGA,CAAA,GAAM,CACtB;AACA,GAAI,MAAO,CAAAC,MAAM,CAACC,IAAI,GAAK,WAAW,EAAID,MAAM,CAACC,IAAI,CAACC,GAAG,CAAE,CACzD;AACA,MAAO,CAAAF,MAAM,CAACC,IAAI,CAACC,GAAG,CAACC,YAAY,EAAI,2BAA2B,CACpE,CACA;AACA;AACA,MAAO,2BAA2B,CACpC,CAAC,CAED,KAAM,CAAAC,YAAY,CAAGL,SAAS,CAAC,CAAC,CAEhC,MAAO,MAAM,CAAAM,aAAa,CAAGR,gBAAgB,CAC3C,uBAAuB,CACvB,MAAOS,WAAW,CAAAC,IAAA,GAA0B,IAAxB,CAAEC,eAAgB,CAAC,CAAAD,IAAA,CACrC,GAAI,CACF,KAAM,CAAAE,QAAQ,CAAG,KAAM,CAAAX,KAAK,CAACY,IAAI,IAAAC,MAAA,CAAIP,YAAY,mBAAkBE,WAAW,CAAC,CAC/E,MAAO,CAAAG,QAAQ,CAACG,IAAI,CACtB,CAAE,MAAOC,KAAK,CAAE,KAAAC,eAAA,CAAAC,gBAAA,CAAAC,qBAAA,CACd;AACAC,OAAO,CAACJ,KAAK,CAAC,4BAA4B,CAAE,EAAAC,eAAA,CAAAD,KAAK,CAACJ,QAAQ,UAAAK,eAAA,iBAAdA,eAAA,CAAgBF,IAAI,GAAIC,KAAK,CAACK,OAAO,CAAC,CAClF,MAAO,CAAAV,eAAe,CACpB,EAAAO,gBAAA,CAAAF,KAAK,CAACJ,QAAQ,UAAAM,gBAAA,kBAAAC,qBAAA,CAAdD,gBAAA,CAAgBH,IAAI,UAAAI,qBAAA,iBAApBA,qBAAA,CAAsBG,MAAM,GAC5BN,KAAK,CAACK,OAAO,EACb,4BACF,CAAC,CACH,CACF,CACF,CAAC,CAED,KAAM,CAAAE,YAAY,CAAGxB,WAAW,CAAC,CAC/ByB,IAAI,CAAE,SAAS,CACfC,YAAY,CAAE,CACZC,OAAO,CAAE,KAAK,CACdV,KAAK,CAAE,IAAI,CACXW,OAAO,CAAE,KACX,CAAC,CACDC,QAAQ,CAAE,CACRC,WAAW,CAAGC,KAAK,EAAK,CACtBA,KAAK,CAACJ,OAAO,CAAG,KAAK,CACrBI,KAAK,CAACH,OAAO,CAAG,KAAK,CACrBG,KAAK,CAACd,KAAK,CAAG,IAAI,CACpB,CACF,CAAC,CACDe,aAAa,CAAGC,OAAO,EAAK,CAC1BA,OAAO,CACJC,OAAO,CAACzB,aAAa,CAAC0B,OAAO,CAAGJ,KAAK,EAAK,CACzCA,KAAK,CAACJ,OAAO,CAAG,IAAI,CACpBI,KAAK,CAACd,KAAK,CAAG,IAAI,CAClBc,KAAK,CAACH,OAAO,CAAG,KAAK,CACvB,CAAC,CAAC,CACDM,OAAO,CAACzB,aAAa,CAAC2B,SAAS,CAAGL,KAAK,EAAK,CAC3CA,KAAK,CAACJ,OAAO,CAAG,KAAK,CACrBI,KAAK,CAACH,OAAO,CAAG,IAAI,CACtB,CAAC,CAAC,CACDM,OAAO,CAACzB,aAAa,CAAC4B,QAAQ,CAAE,CAACN,KAAK,CAAEO,MAAM,GAAK,CAClDP,KAAK,CAACJ,OAAO,CAAG,KAAK,CACrBI,KAAK,CAACd,KAAK,CAAGqB,MAAM,CAACC,OAAO,CAC9B,CAAC,CAAC,CACN,CACF,CAAC,CAAC,CAEF,MAAO,MAAM,CAAET,WAAY,CAAC,CAAGN,YAAY,CAACgB,OAAO,CACnD,cAAe,CAAAhB,YAAY,CAACiB,OAAO","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}